<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test User Persistence</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .test-section { 
            background: #f0f0f0; 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 5px; 
        }
        .success { background: #d4edda; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test User Persistence</h1>
        
        <div class="test-section">
            <h3>üìä Current Auth Data in localStorage</h3>
            <button onclick="checkAuthData()">Check Auth Data</button>
            <button onclick="clearAuthData()">Clear Auth Data</button>
            <pre id="auth-data">Click "Check Auth Data" to see current data</pre>
        </div>

        <div class="test-section">
            <h3>üîß Test Auth Storage Service</h3>
            <button onclick="testStoreData()">Store Test Data</button>
            <button onclick="testRetrieveData()">Retrieve Data</button>
            <button onclick="testValidation()">Test Validation</button>
            <pre id="test-results">Click buttons to test functionality</pre>
        </div>

        <div class="test-section">
            <h3>üîÑ Test Page Refresh Persistence</h3>
            <p>After storing data, refresh this page to test if it persists.</p>
            <button onclick="location.reload()">Refresh Page</button>
        </div>
    </div>

    <script>
        // Mock AuthStorageService for testing
        const AuthStorageService = {
            AUTH_KEY: 'mayhem_auth',
            
            storeAuthData(authData) {
                try {
                    localStorage.setItem(this.AUTH_KEY, JSON.stringify(authData));
                    return true;
                } catch (error) {
                    console.error('Error storing auth data:', error);
                    return false;
                }
            },
            
            getAuthData() {
                try {
                    const data = localStorage.getItem(this.AUTH_KEY);
                    return data ? JSON.parse(data) : null;
                } catch (error) {
                    console.error('Error retrieving auth data:', error);
                    return null;
                }
            },
            
            isAuthenticated() {
                const authData = this.getAuthData();
                return authData && authData.user && authData.session;
            },
            
            clearAuthData() {
                localStorage.removeItem(this.AUTH_KEY);
            }
        };

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}`;
            console.log(logMessage);
            
            const output = document.getElementById('test-results');
            output.textContent += logMessage + '\n';
            output.scrollTop = output.scrollHeight;
        }

        function checkAuthData() {
            const authData = AuthStorageService.getAuthData();
            const isAuth = AuthStorageService.isAuthenticated();
            
            const output = document.getElementById('auth-data');
            
            if (authData) {
                output.textContent = `‚úÖ Auth Data Found:
Is Authenticated: ${isAuth}
User ID: ${authData.user?.id || 'N/A'}
Email: ${authData.user?.email || 'N/A'}
Role: ${authData.user?.role || 'N/A'}
First Name: ${authData.user?.firstName || 'N/A'}
Last Name: ${authData.user?.lastName || 'N/A'}
Avatar: ${authData.user?.avatar || 'N/A'}
Session ID: ${authData.session?.sessionId || 'N/A'}
Last Activity: ${authData.session?.lastActivity || 'N/A'}

Full Data:
${JSON.stringify(authData, null, 2)}`;
            } else {
                output.textContent = '‚ùå No auth data found in localStorage';
            }
        }

        function clearAuthData() {
            AuthStorageService.clearAuthData();
            log('üóëÔ∏è Auth data cleared from localStorage');
            checkAuthData();
        }

        function testStoreData() {
            const testData = {
                user: {
                    id: 123,
                    email: 'test@example.com',
                    role: 'customer',
                    firstName: 'John',
                    lastName: 'Doe',
                    isEmailVerified: true,
                    lastLoginAt: new Date().toISOString(),
                    createdAt: new Date().toISOString(),
                    avatar: 'https://ui-avatars.com/api/?name=John+Doe&background=3b82f6&color=ffffff'
                },
                session: {
                    sessionId: 'test-session-123',
                    accessToken: 'test-access-token',
                    refreshToken: 'test-refresh-token',
                    lastActivity: new Date().toISOString()
                }
            };

            const success = AuthStorageService.storeAuthData(testData);
            if (success) {
                log('‚úÖ Test data stored successfully');
                checkAuthData();
            } else {
                log('‚ùå Failed to store test data');
            }
        }

        function testRetrieveData() {
            const authData = AuthStorageService.getAuthData();
            if (authData) {
                log('‚úÖ Data retrieved successfully');
                log(`User: ${authData.user.firstName} ${authData.user.lastName} (${authData.user.email})`);
                log(`Role: ${authData.user.role}`);
                log(`Session: ${authData.session.sessionId}`);
            } else {
                log('‚ùå No data found');
            }
        }

        function testValidation() {
            const isAuth = AuthStorageService.isAuthenticated();
            log(`Authentication Status: ${isAuth ? '‚úÖ Authenticated' : '‚ùå Not Authenticated'}`);
            
            if (isAuth) {
                const authData = AuthStorageService.getAuthData();
                log(`User Role: ${authData.user.role}`);
                log(`Session Valid: ${!!authData.session.sessionId}`);
            }
        }

        // Auto-check auth data on page load
        document.addEventListener('DOMContentLoaded', function() {
            log('üöÄ Persistence test page loaded');
            checkAuthData();
        });
    </script>
</body>
</html>
